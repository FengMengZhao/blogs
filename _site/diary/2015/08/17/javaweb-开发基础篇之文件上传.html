<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>麦羞 - javaweb开发基础篇之文件上传</title>
  <meta name="author" content="麦羞" />
  <meta name="description" content="The blog of 麦羞" />
  <link rel="canonical" href="/blogs/diary/2015/08/17/javaweb-%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0.html" />
  <!-- <script type="text/javascript" src="//use.typekit.net/jxo0xyj.js"></script> -->
  <!-- <script type="text/javascript">try{Typekit.load();}catch(e){}</script> -->
  <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="/blogs/assets/images/favicon.png">
  <link rel="alternate" type="application/rss+xml" title="麦羞" href="/blogs/atom.xml" />
  <link rel="stylesheet" href="/blogs/assets/css/all.css">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.min.css">
</head>
<body>
  <div class="container">
    <div class="four columns sidebar">
      <nav>
  <h1>博客</h1>
  <a href="/">
      <img src="/blogs/assets/images/fmz-logo2.png" id="logo" alt="Blog logo"/>
  </a>
  <h2>@ <a href="/blogs/resume">麦羞</a>.</h2>
  <hr/>
  <ul>
  <p>在这里我分享我的每一步成长 </p>
  <p>
    我是一名在读研究生
  </p>
  <hr/>
  <div>
    <div id="social">
      Follow me:
<div id="stalker">
  
  <a title="FengMengZhao on Github" href="https://github.com/FengMengZhao">
    <i class="fa fa-github-square"></i>
  </a>
  

  
  <a title="fengmengzhao on Twitter" href="https://twitter.com/fengmengzhao">
    <i class="fa fa-twitter-square"></i>
  </a>
  

  
  <a title="麦羞 on Facebook" href="https://facebook.com/100008350779619">
    <i class="fa fa-facebook-square"></i>
  </a>
  

  
  <a title="麦羞 on Google Plus" href="https://plus.google.com/105478354193409781551">
    <i class="fa fa-google-plus-square"></i>
  </a>
  

</div>

    </div>
  </div>
  </ul>
</nav>

    </div>

    <div class="eleven columns content">
        <p class="meta">
  August 17, 2015
  <a href="/">
    <i class="home fa fa-home"></i>
  </a>
</p>

<h1 class="title">javaweb开发基础篇之文件上传</h1>

<div id="post">
  <h2 id="目录">目录</h2>

<ul>
  <li>
    <p><a href="#1">1 SmartUpload 上传组件</a></p>

    <ul>
      <li>
        <p><a href="#1.1">1.1 上传单个文件</a></p>
      </li>
      <li>
        <p><a href="#1.2">1.2 混合表单</a></p>
      </li>
      <li>
        <p><a href="#1.3">1.3 为上传文件自动命名</a></p>
      </li>
      <li>
        <p><a href="#1.4">1.4 批量上传文件</a></p>
      </li>
    </ul>
  </li>
  <li>
    <p><a href="#2">2 2 FileUpload</a></p>

    <ul>
      <li>
        <p><a href="#2.1">2.1 使用FileUpload组件接收上传内容</a></p>
      </li>
      <li>
        <p><a href="#2.2">2.2 保存上传内容</a></p>
      </li>
      <li>
        <p><a href="#2.3">2.3 开发FileUpload组件的专属操作类</a></p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<hr />

<h2 id="1">1 SmartUpload 上传组件</h2>

<p>  SmartUpload 是一套上传组件包，可以实现文件的上传及下载功能，可以轻松的实现上传文件类型的限制，也可以轻易的取得上传文件的名称、后缀、大小等等</p>

<h3 id="1.1">1.1 上传单个文件</h3>

<p>  上传表单-smart_upload_demo01.html</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
	<span class="nt">&lt;head&gt;</span>
		<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;title&gt;&lt;/title&gt;</span>
	<span class="nt">&lt;/head&gt;</span>
	<span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"smart_upload_demo01.jsp"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
			请选择文件：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"pic"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"提交"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;/form&gt;</span>
	<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>在form中使用了<code class="highlighter-rouge">enctype="multipart/form-data"</code>进行了封装，表示表单将按照二进制的方式进行提交。</p>
</blockquote>

<p>  接受文件，保存在项目更目录upload文件夹下-smart_upload_demp01.jsp</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">contentType=</span><span class="s">"text/html"</span> <span class="na">pageEncoding=</span><span class="s">"utf-8"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">import=</span><span class="s">"org.lxh.smart.*"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
	<span class="nt">&lt;head&gt;</span>
		<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;title&gt;&lt;/title&gt;</span>
	<span class="nt">&lt;/head&gt;</span>
	<span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;</span><span class="err">%</span>
			<span class="na">request</span><span class="err">.</span><span class="na">setCharacterEncoding</span><span class="err">("</span><span class="na">utf-8</span><span class="err">")</span> <span class="err">;</span>
			<span class="na">SmartUpload</span> <span class="na">smart =</span><span class="err"> </span><span class="s">new</span> <span class="na">SmartUpload</span><span class="err">()</span> <span class="err">;//实例化</span><span class="na">SmartUpload</span><span class="err">上传组件</span>
			<span class="na">smart</span><span class="err">.</span><span class="na">initialize</span><span class="err">(</span><span class="na">pageContext</span><span class="err">)</span> <span class="err">;//初始化上传操作</span>
			<span class="na">smart</span><span class="err">.</span><span class="na">upload</span><span class="err">()</span> <span class="err">;//上传准备</span>
			<span class="na">smart</span><span class="err">.</span><span class="na">save</span><span class="err">("/</span><span class="na">upload</span><span class="err">")</span> <span class="err">;//将上传的文件保存在</span><span class="na">upload</span><span class="err">文件夹中</span>
		<span class="err">%</span><span class="nt">&gt;</span>
	<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h3 id="1.2">1.2 混合表单</h3>

<p>  表单一旦被enctype封装之后，其他的非表单控件的内容无法通过request内置对象获得，此时必粗通过SmartUpload类种提供的getRequest()方法取得全部的请求参数。</p>

<p>  混合表单-smart_upload_demo02.html</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
	<span class="nt">&lt;head&gt;</span>
		<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;title&gt;&lt;/title&gt;</span>
	<span class="nt">&lt;/head&gt;</span>
	<span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"smart_upload_demo02.jsp"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">encType=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
			姓名：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"uname"</span><span class="nt">&gt;&lt;br&gt;</span>
			照片：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"pic"</span><span class="nt">&gt;&lt;br&gt;</span>
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"上传"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"reset"</span> <span class="na">value=</span><span class="s">"重置"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;/form&gt;</span>
	<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>  接收封装表单文本数据-smart_uploade_demo02.jsp</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">contentType=</span><span class="s">"text/html"</span> <span class="na">pageEncoding=</span><span class="s">"utf-8"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">import=</span><span class="s">"org.lxh.smart.*"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
	<span class="nt">&lt;head&gt;</span>
		<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;title&gt;&lt;/title&gt;</span>
	<span class="nt">&lt;/head&gt;</span>
	<span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;</span><span class="err">%</span>
			<span class="na">request</span><span class="err">.</span><span class="na">setCharacterEncoding</span><span class="err">("</span><span class="na">utf-8</span><span class="err">")</span> <span class="err">;</span>
			<span class="na">SmartUpload</span> <span class="na">smart =</span><span class="err"> </span><span class="s">new</span> <span class="na">SmartUpload</span><span class="err">()</span> <span class="err">;</span>
			<span class="na">smart</span><span class="err">.</span><span class="na">initialize</span><span class="err">(</span><span class="na">pageContext</span><span class="err">)</span> <span class="err">;</span>
			<span class="na">smart</span><span class="err">.</span><span class="na">upload</span><span class="err">()</span> <span class="err">;</span>
			<span class="na">String</span> <span class="na">name =</span><span class="err"> </span><span class="s">smart.getRequest().getParameter("uname")</span> <span class="err">;</span>
			<span class="na">smart</span><span class="err">.</span><span class="na">save</span><span class="err">("/</span><span class="na">upload</span><span class="err">")</span> <span class="err">;</span>
		<span class="err">%</span><span class="nt">&gt;</span>
		<span class="nt">&lt;h2&gt;</span>姓名：<span class="nt">&lt;</span><span class="err">%=</span><span class="na">name</span><span class="err">%</span><span class="nt">&gt;&lt;/h2&gt;</span>
		<span class="nt">&lt;h2&gt;</span>封装后无法通过request内置对象取得：<span class="nt">&lt;</span><span class="err">%=</span><span class="na">request</span><span class="err">.</span><span class="na">getParameter</span><span class="err">("</span><span class="na">uname</span><span class="err">")%</span><span class="nt">&gt;</span>
	<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>乱码问题没有解决</p>
</blockquote>

<blockquote>
  <p>通过smart.getRequest()方法，必须在smart.upload()完成之后才能实现。</p>
</blockquote>

<h3 id="1.3">1.3 为上传文件自动命名</h3>

<p>  在上述的上传方式中，如果用户长传的文件名称一致，那么就会发生覆盖，为了解决这个问题，可以采用自动命名的方式，自动命名的方式可以采用 IP地址 + 时间戳 + 三位随机数 的方式。</p>

<p>  定义取得IP、时间戳的操作类-IpTimeStamp.java</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">cn</span><span class="p">.</span><span class="n">fmz</span><span class="p">.</span><span class="n">custom</span><span class="p">.</span><span class="n">util</span> <span class="p">;</span>

<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">text</span><span class="p">.*</span> <span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.*</span> <span class="p">;</span>

<span class="k">public</span> <span class="n">class</span> <span class="n">IpTimeStamp</span><span class="p">{</span>
	<span class="n">private</span> <span class="n">SimpleDateFormat</span> <span class="n">sdf</span> <span class="p">=</span> <span class="n">null</span> <span class="p">;</span>
	<span class="n">private</span> <span class="k">String</span> <span class="n">ip</span> <span class="p">=</span> <span class="n">null</span> <span class="p">;</span>
	
	<span class="k">public</span> <span class="n">IpTimeStamp</span><span class="p">(){</span>
	
	<span class="p">}</span>
	<span class="k">public</span> <span class="n">IpTimeStamp</span><span class="p">(</span><span class="k">String</span> <span class="n">ip</span><span class="p">){</span>
		<span class="n">this</span><span class="p">.</span><span class="n">ip</span> <span class="p">=</span> <span class="n">ip</span> <span class="p">;</span>
	<span class="p">}</span>

	<span class="k">public</span> <span class="k">String</span> <span class="n">getIpTimeRandom</span><span class="p">(){</span>
		<span class="n">StringBuffer</span> <span class="n">buf</span> <span class="p">=</span> <span class="n">new</span> <span class="n">StringBuffer</span><span class="p">()</span> <span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">ip</span> <span class="c1">!= null){
</span>			<span class="k">String</span><span class="p">[]</span> <span class="n">s</span> <span class="p">=</span> <span class="n">this</span><span class="p">.</span><span class="n">ip</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">:"</span><span class="p">)</span> <span class="p">;</span>
			<span class="n">for</span><span class="p">(</span><span class="n">int</span> <span class="n">i</span><span class="p">=</span><span class="m">0</span><span class="p">;</span><span class="n">i</span><span class="p">&lt;</span><span class="n">s</span><span class="p">.</span><span class="n">length</span><span class="p">;</span><span class="n">i</span><span class="p">++){</span>
				<span class="n">buf</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">addZero</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="m">3</span><span class="p">))</span> <span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="n">buf</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">getTimeStamp</span><span class="p">())</span> <span class="p">;</span>

		<span class="n">Random</span> <span class="n">r</span> <span class="p">=</span> <span class="n">new</span> <span class="n">Random</span><span class="p">()</span> <span class="p">;</span>
		<span class="n">for</span><span class="p">(</span><span class="n">int</span> <span class="n">i</span><span class="p">=</span><span class="m">0</span><span class="p">;</span><span class="n">i</span><span class="p">&lt;</span><span class="m">3</span><span class="p">;</span><span class="n">i</span><span class="p">++){</span>
			<span class="n">buf</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">nextInt</span><span class="p">(</span><span class="m">10</span><span class="p">))</span> <span class="p">;</span>
		<span class="p">}</span>

		<span class="n">return</span> <span class="n">buf</span><span class="p">.</span><span class="n">toString</span><span class="p">()</span> <span class="p">;</span>
	<span class="p">}</span>

	<span class="n">private</span> <span class="k">String</span> <span class="n">addZero</span><span class="p">(</span><span class="k">String</span> <span class="n">str</span><span class="p">,</span><span class="n">int</span> <span class="n">len</span><span class="p">){</span>
		<span class="n">StringBuffer</span> <span class="n">buf</span> <span class="p">=</span> <span class="n">new</span> <span class="n">StringBuffer</span><span class="p">()</span> <span class="p">;</span>
		<span class="n">buf</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="p">;</span>
		<span class="k">while</span><span class="p">(</span><span class="n">buf</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="p">&lt;</span> <span class="n">len</span><span class="p">){</span>
			<span class="n">buf</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="s2">"0"</span><span class="p">)</span> <span class="p">;</span>
		<span class="p">}</span>
		<span class="n">return</span> <span class="n">buf</span><span class="p">.</span><span class="n">toString</span><span class="p">()</span> <span class="p">;</span>
	<span class="p">}</span>
	
	<span class="k">public</span> <span class="k">String</span> <span class="n">getTimeStamp</span><span class="p">(){</span>
		<span class="n">this</span><span class="p">.</span><span class="n">sdf</span> <span class="p">=</span> <span class="n">new</span> <span class="n">SimpleDateFormat</span><span class="p">(</span><span class="s2">"yyyyMMddHHmmssSSS"</span><span class="p">)</span> <span class="p">;</span>
		<span class="n">return</span> <span class="n">this</span><span class="p">.</span><span class="n">sdf</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">new</span> <span class="n">Date</span><span class="p">())</span> <span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>编译之后可以更新jar文件，doc中输入如下指令：<code class="highlighter-rouge">jar uf ../lib/javaweb_based.jar(指定路径的jar文件) cn(文件夹)</code></p>
</blockquote>

<blockquote>
  <p>由于使用的是Ipv6,所以Ip的格式是 xx:xx:xx:xx:…，在上述代码解析的时候要用代码：<code class="highlighter-rouge">String[] s = this.ip.split("\\:") ;</code>才可以。</p>
</blockquote>

<p>  自动命名实现-smart_upload_demo03.jsp</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">contentType=</span><span class="s">"text/html"</span> <span class="na">pageEncoding=</span><span class="s">"UTF-8"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">import=</span><span class="s">"org.lxh.smart.*"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">import=</span><span class="s">"cn.fmz.custom.util.*"</span><span class="err">%</span><span class="nt">&gt;</span>

<span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
	<span class="nt">&lt;head&gt;</span>
		<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;title&gt;&lt;/title&gt;</span>
	<span class="nt">&lt;/head&gt;</span>
	<span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;</span><span class="err">%</span>
			<span class="na">request</span><span class="err">.</span><span class="na">setCharacterEncoding</span><span class="err">("</span><span class="na">utf-8</span><span class="err">")</span> <span class="err">;</span>
			<span class="na">SmartUpload</span> <span class="na">smart =</span><span class="err"> </span><span class="s">new</span> <span class="na">SmartUpload</span><span class="err">()</span> <span class="err">;</span>
			<span class="na">smart</span><span class="err">.</span><span class="na">initialize</span><span class="err">(</span><span class="na">pageContext</span><span class="err">)</span> <span class="err">;</span>
			<span class="na">smart</span><span class="err">.</span><span class="na">upload</span><span class="err">()</span> <span class="err">;</span>
			<span class="na">String</span> <span class="na">name =</span><span class="err"> </span><span class="s">smart.getRequest().getParameter("uname")</span> <span class="err">;</span>
			<span class="na">IpTimeStamp</span> <span class="na">its =</span><span class="err"> </span><span class="s">new</span> <span class="na">IpTimeStamp</span><span class="err">(</span><span class="na">request</span><span class="err">.</span><span class="na">getRemoteAddr</span><span class="err">())</span> <span class="err">;</span>
			<span class="na">String</span> <span class="na">ext =</span><span class="err"> </span><span class="s">smart.getFiles().getFile(0).getFileExt()</span> <span class="err">;//取得文件后缀</span>
			<span class="na">String</span> <span class="na">fileName =</span><span class="err"> </span><span class="s">its.getIpTimeRandom()</span> <span class="err">+</span> <span class="err">"."</span> <span class="err">+</span> <span class="na">ext</span> <span class="err">;//拼凑文件的名称</span>
			<span class="na">boolean</span> <span class="na">flag =</span><span class="err"> </span><span class="s">false</span> <span class="err">;</span>
			<span class="na">flag =</span><span class="err"> </span><span class="s">smart.getFiles().getFile(0).getFileName().matches("^\\w+.(jpg|gif)$")</span> <span class="err">;</span>
			<span class="na">if</span><span class="err">(</span><span class="na">flag</span><span class="err">){</span>
				<span class="na">smart</span><span class="err">.</span><span class="na">getFiles</span><span class="err">().</span><span class="na">getFile</span><span class="err">(</span><span class="na">0</span><span class="err">).</span><span class="na">saveAs</span><span class="err">(</span><span class="na">this</span><span class="err">.</span><span class="na">getServletContext</span><span class="err">().</span><span class="na">getRealPath</span><span class="err">("/")+"</span><span class="na">upload</span><span class="err">"+</span><span class="na">java</span><span class="err">.</span><span class="na">io</span><span class="err">.</span><span class="na">File</span><span class="err">.</span><span class="na">separator</span> <span class="err">+</span> <span class="na">fileName</span><span class="err">)</span> <span class="err">;</span>
		<span class="err">%</span><span class="nt">&gt;</span>
			<span class="nt">&lt;center&gt;&lt;h2&gt;</span>文件上传成功！<span class="nt">&lt;/h2&gt;&lt;/center&gt;</span>
		<span class="nt">&lt;</span><span class="err">%</span>
			<span class="err">}</span><span class="na">else</span><span class="err">{</span>
		<span class="err">%</span><span class="nt">&gt;</span>
			<span class="nt">&lt;center&gt;&lt;h2&gt;</span>文件格式不正确，上传失败！<span class="nt">&lt;/h2&gt;&lt;/center&gt;</span>
		<span class="nt">&lt;</span><span class="err">%</span>
			<span class="err">}</span>
		<span class="err">%</span><span class="nt">&gt;</span>
			<span class="nt">&lt;center&gt;</span>
				<span class="nt">&lt;h2&gt;</span>姓名：<span class="nt">&lt;</span><span class="err">%=</span><span class="na">name</span><span class="err">%</span><span class="nt">&gt;&lt;/h2&gt;</span>
				<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"../upload/&lt;%=fileName%&gt;"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;/center&gt;</span>
	<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h3 id="1.4">1.4 批量上传文件</h3>

<p>  通过代码：<code class="highlighter-rouge">smart.getFiles().getFile(0).saveAs(this.getServletContext().getRealPath("/")+"upload"+java.io.File.separator + fileName) ;</code>给我们启发，通过循环可以批量上传文件。</p>

<p>  表单文件-smart_upload_demo04.html</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
	<span class="nt">&lt;head&gt;</span>
		<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;title&gt;&lt;/title&gt;</span>
	<span class="nt">&lt;/head&gt;</span>
	<span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"smart_upload_demo04.jsp"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">encType=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
			照片1：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"pic01"</span><span class="nt">&gt;&lt;br&gt;</span>
			照片2：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"pic02"</span><span class="nt">&gt;&lt;br&gt;</span>
			照片3：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"pic03"</span><span class="nt">&gt;&lt;br&gt;</span>
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"上传"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"reset"</span> <span class="na">value=</span><span class="s">"重置"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;/form&gt;</span>
	<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>  接收表单文件-smart_upload_demo04.jsp</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">contentType=</span><span class="s">"text/html"</span> <span class="na">pageEncoding=</span><span class="s">"utf-8"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">import=</span><span class="s">"org.lxh.smart.*,cn.fmz.custom.util.*"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
	<span class="nt">&lt;head&gt;</span>
		<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;title&gt;&lt;/title&gt;</span>
	<span class="nt">&lt;/head&gt;</span>
	<span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;</span><span class="err">%</span>
			<span class="na">request</span><span class="err">.</span><span class="na">setCharacterEncoding</span><span class="err">("</span><span class="na">utf-8</span><span class="err">")</span> <span class="err">;</span>
			<span class="na">SmartUpload</span> <span class="na">smart =</span><span class="err"> </span><span class="s">new</span> <span class="na">SmartUpload</span><span class="err">()</span> <span class="err">;</span>
			<span class="na">smart</span><span class="err">.</span><span class="na">initialize</span><span class="err">(</span><span class="na">pageContext</span><span class="err">)</span> <span class="err">;</span>
			<span class="na">smart</span><span class="err">.</span><span class="na">upload</span><span class="err">()</span> <span class="err">;</span>
			<span class="na">IpTimeStamp</span> <span class="na">its =</span><span class="err"> </span><span class="s">new</span> <span class="na">IpTimeStamp</span><span class="err">(</span><span class="na">request</span><span class="err">.</span><span class="na">getRemoteAddr</span><span class="err">())</span> <span class="err">;</span>
			<span class="na">for</span><span class="err">(</span><span class="na">int</span> <span class="na">x=</span><span class="s">0;x&lt;smart.getFiles().getCount();x++){</span>
				<span class="na">boolean</span> <span class="na">flag =</span><span class="err"> </span><span class="s">false</span> <span class="err">;</span>
				<span class="na">flag =</span><span class="err"> </span><span class="s">smart.getFiles().getFile(x).getFileName().matches("^\\w+.(jpg|gif)$")</span> <span class="err">;</span>
				<span class="na">if</span><span class="err">(</span><span class="na">flag</span><span class="err">){</span>
					<span class="na">String</span> <span class="na">ext =</span><span class="err"> </span><span class="s">smart.getFiles().getFile(x).getFileExt()</span> <span class="err">;</span>
					<span class="na">String</span> <span class="na">fileName =</span><span class="err"> </span><span class="s">its.getIpTimeRandom()</span> <span class="err">+</span> <span class="err">"."</span> <span class="err">+</span> <span class="na">ext</span> <span class="err">;</span>
					<span class="na">smart</span><span class="err">.</span><span class="na">getFiles</span><span class="err">().</span><span class="na">getFile</span><span class="err">(</span><span class="na">x</span><span class="err">).</span><span class="na">saveAs</span><span class="err">(</span><span class="na">this</span><span class="err">.</span><span class="na">getServletContext</span><span class="err">().</span><span class="na">getRealPath</span><span class="err">("/")</span> <span class="err">+</span> <span class="err">"</span><span class="na">upload</span><span class="err">"</span> <span class="err">+</span><span class="na">java</span><span class="err">.</span><span class="na">io</span><span class="err">.</span><span class="na">File</span><span class="err">.</span><span class="na">separator</span> <span class="err">+</span><span class="na">fileName</span><span class="err">)</span> <span class="err">;</span>
		<span class="err">%</span><span class="nt">&gt;</span>
				<span class="nt">&lt;center&gt;</span>
					<span class="nt">&lt;h2&gt;</span>第<span class="nt">&lt;</span><span class="err">%=</span><span class="na">x</span><span class="err">+</span><span class="na">1</span><span class="err">%</span><span class="nt">&gt;</span>个文件上传成功！文件名称为：<span class="nt">&lt;</span><span class="err">%=</span><span class="na">fileName</span><span class="err">%</span><span class="nt">&gt;&lt;/h2&gt;</span>
				<span class="nt">&lt;/center&gt;</span>

		<span class="nt">&lt;</span><span class="err">%</span>
				<span class="err">}</span><span class="na">else</span><span class="err">{</span>
		<span class="err">%</span><span class="nt">&gt;</span>
			<span class="nt">&lt;center&gt;</span>
				<span class="nt">&lt;h2&gt;</span>第<span class="nt">&lt;</span><span class="err">%=</span><span class="na">x</span><span class="err">+</span><span class="na">1</span><span class="err">%</span><span class="nt">&gt;</span>个文件上传失败！<span class="nt">&lt;/h2&gt;</span>
			<span class="nt">&lt;/center&gt;</span>

		<span class="nt">&lt;</span><span class="err">%</span>
				<span class="err">}</span>
			<span class="err">}</span>
		<span class="err">%</span><span class="nt">&gt;</span>
	<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<hr />

<hr />

<h2 id="2">2 FileUpload</h2>

<p>  FileUpload是Apache组织免费提供的上传组件包，可以直接从Apache组织站点记性<a href="http://commons.apache.org/proper/commons-fileupload/" title="FileUpload 组件下载">下载</a> 。但是FileUpload组件本身还依赖Commons组件，所以要连同Commons组件的IO包一起<a href="http://commons.apache.org/proper/commons-io/" title="commonts 组件 IO 包下载">下载</a></p>

<blockquote>
  <p>从实际的开发来讲，FileUpload组件使用起来会非常麻烦，建议多使用SmartUpload组件</p>
</blockquote>

<h3 id="2.1">2.1 使用FileUpload组件接收上传内容</h3>

<p>  上传表单文件-file_upload_demo01.html</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
	<span class="nt">&lt;head&gt;</span>
		<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;title&gt;&lt;/title&gt;</span>
	<span class="nt">&lt;/head&gt;</span>
	<span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"file_upload_demo01.jsp"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
			姓名：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"uname"</span><span class="nt">&gt;&lt;br&gt;</span>
			照片：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"pic"</span><span class="nt">&gt;&lt;br&gt;</span>
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"提交"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"reset"</span> <span class="na">value=</span><span class="s">"重置"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;/form&gt;</span>
	<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>  接收FileUpload上传的基本步骤</p>

<p>  1. 创建磁盘工厂：<code class="highlighter-rouge">DiskFileItemFactory factory = new DiskFileItemFactory() ;</code></p>

<p>  2. 创建处理工具：<code class="highlighter-rouge">ServletFileUpload upload = new ServletFileUpload(factory) ;</code></p>

<p>  3. 设置上传文件的大小：upload.setFileSizeMax(3145728) ;</p>

<p>  4. 接收全部内容：List<FileItem> items = upload.parseRequest(request) ;</FileItem></p>

<p>  接收表单文件-file_upload_demo01.jsp</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">contentType=</span><span class="s">"text/html"</span> <span class="na">pageEncoding=</span><span class="s">"utf-8"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">import=</span><span class="s">"java.util.*"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">import=</span><span class="s">"org.apache.commons.fileupload.disk.*"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">import=</span><span class="s">"org.apache.commons.fileupload.servlet.*"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">import=</span><span class="s">"org.apache.commons.fileupload.*"</span><span class="err">%</span><span class="nt">&gt;</span>

<span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
	<span class="nt">&lt;head&gt;</span>
		<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;title&gt;&lt;/title&gt;</span>
	<span class="nt">&lt;/head&gt;</span>
	<span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;</span><span class="err">%</span>
			<span class="na">request</span><span class="err">.</span><span class="na">setCharacterEncoding</span><span class="err">("</span><span class="na">utf-8</span><span class="err">")</span> <span class="err">;</span>
			<span class="na">DiskFileItemFactory</span> <span class="na">factory =</span><span class="err"> </span><span class="s">new</span> <span class="na">DiskFileItemFactory</span><span class="err">()</span> <span class="err">;</span>
			<span class="na">ServletFileUpload</span> <span class="na">upload =</span><span class="err"> </span><span class="s">new</span> <span class="na">ServletFileUpload</span><span class="err">(</span><span class="na">factory</span><span class="err">)</span> <span class="err">;</span>
			<span class="na">upload</span><span class="err">.</span><span class="na">setFileSizeMax</span><span class="err">(</span><span class="na">3145728</span><span class="err">)</span> <span class="err">;</span>
			<span class="na">List</span><span class="err">&lt;</span><span class="na">FileItem</span><span class="nt">&gt;</span> items = upload.parseRequest(request) ;
			Iterator<span class="nt">&lt;FileItem&gt;</span> itr = items.iterator() ;
			while(itr.hasNext()){
				FileItem item = itr.next() ;
				String fieldName = item.getFieldName() ;
		%&gt;
			<span class="nt">&lt;ul&gt;&lt;h4&gt;</span>表单控件的名称：<span class="nt">&lt;</span><span class="err">%=</span><span class="na">fieldName</span><span class="err">%</span><span class="nt">&gt;</span> --&gt; <span class="nt">&lt;</span><span class="err">%=</span><span class="na">item</span><span class="err">.</span><span class="na">isFormField</span><span class="err">()%</span><span class="nt">&gt;&lt;/h4&gt;</span>
		<span class="nt">&lt;</span><span class="err">%</span>
				<span class="na">if</span><span class="err">(!</span><span class="na">item</span><span class="err">.</span><span class="na">isFormField</span><span class="err">()){//不是普通的文本数据，是上传文件</span>
					<span class="na">String</span> <span class="na">fileName =</span><span class="err"> </span><span class="s">item.getName()</span> <span class="err">;</span>
					<span class="na">String</span> <span class="na">contentType =</span><span class="err"> </span><span class="s">item.getContentType()</span> <span class="err">;</span>
					<span class="na">long</span> <span class="na">sizeInBytes =</span><span class="err"> </span><span class="s">item.getSize()</span> <span class="err">;</span>
		<span class="err">%</span><span class="nt">&gt;</span>
				<span class="nt">&lt;li&gt;</span>上传文件名称：<span class="nt">&lt;</span><span class="err">%=</span><span class="na">fileName</span><span class="err">%</span><span class="nt">&gt;&lt;/li&gt;</span>
				<span class="nt">&lt;li&gt;</span>上传文件类型：<span class="nt">&lt;</span><span class="err">%=</span><span class="na">contentType</span><span class="err">%</span><span class="nt">&gt;&lt;/li&gt;</span>
				<span class="nt">&lt;li&gt;</span>上传文件大小：<span class="nt">&lt;</span><span class="err">%=</span><span class="na">sizeInBytes</span><span class="err">%</span><span class="nt">&gt;&lt;/li&gt;</span>
		<span class="nt">&lt;</span><span class="err">%</span>
				<span class="err">}</span><span class="na">else</span><span class="err">{</span>
					<span class="na">String</span> <span class="na">value =</span><span class="err"> </span><span class="s">item.getString()</span> <span class="err">;</span>
		<span class="err">%</span><span class="nt">&gt;</span>
				<span class="nt">&lt;li&gt;</span>普通参数：<span class="nt">&lt;</span><span class="err">%=</span><span class="na">value</span><span class="err">%</span><span class="nt">&gt;&lt;/li&gt;</span>
		<span class="nt">&lt;</span><span class="err">%</span>
				<span class="err">}</span>
		<span class="err">%</span><span class="nt">&gt;</span>
			<span class="nt">&lt;/ul&gt;</span>
		<span class="nt">&lt;</span><span class="err">%</span>
			<span class="err">}</span>
		<span class="err">%</span><span class="nt">&gt;</span>
	<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>FileUpload组件接收完全部的数据之后，就会储存在List集合中，则需要使用Iterator输出，由于其中既有上传文本又有上传文件，所以每一个内容都需要使用FileItem类表示。</p>
</blockquote>

<blockquote>
  <p>当使用Iterator依次取出FileItem对象时，就可以使用FileItem类种的IsFormField()方法判断当前操作的内容是普通文本还是上传文件，如果是上传文件，则将文件内容依次取出；如果是普通文本，直接通过getString()方法取得具体信息。</p>
</blockquote>

<h3 id="2.2">2.2 保存上传内容</h3>

<p>  表单文件-file_upload_demo02.html</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
	<span class="nt">&lt;head&gt;</span>
		<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;title&gt;&lt;/title&gt;</span>
	<span class="nt">&lt;/head&gt;</span>
	<span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"file_upload_demo02.jsp"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
			姓名：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"uname"</span><span class="nt">&gt;&lt;br&gt;</span>
			照片1：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"pic01"</span><span class="nt">&gt;&lt;br&gt;</span>
			照片2：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"pic02"</span><span class="nt">&gt;&lt;br&gt;</span>
			照片3：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"pic03"</span><span class="nt">&gt;&lt;br&gt;</span>
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"提交"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"reset"</span> <span class="na">value=</span><span class="s">"重置"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;/form&gt;</span>
	<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>  接收表单并保存上传文件-file_upload_demo02.jsp</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">contentType=</span><span class="s">"text/html"</span> <span class="na">pageEncoding=</span><span class="s">"utf-8"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">import=</span><span class="s">"java.util.*,java.io.*"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">import=</span><span class="s">"org.apache.commons.fileupload.disk.*"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">import=</span><span class="s">"org.apache.commons.fileupload.servlet.*"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">import=</span><span class="s">"org.apache.commons.fileupload.*"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">import=</span><span class="s">"cn.fmz.custom.util.*"</span><span class="err">%</span><span class="nt">&gt;</span>

<span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
	<span class="nt">&lt;head&gt;</span>
		<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;title&gt;&lt;/title&gt;</span>
	<span class="nt">&lt;/head&gt;</span>
	<span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;</span><span class="err">%</span>
			<span class="na">request</span><span class="err">.</span><span class="na">setCharacterEncoding</span><span class="err">("</span><span class="na">utf-8</span><span class="err">")</span> <span class="err">;</span>
			<span class="na">DiskFileItemFactory</span> <span class="na">factory =</span><span class="err"> </span><span class="s">new</span> <span class="na">DiskFileItemFactory</span><span class="err">()</span> <span class="err">;//创建磁盘工厂</span>
			<span class="na">factory</span><span class="err">.</span><span class="na">setRepository</span><span class="err">(</span><span class="na">new</span> <span class="na">File</span><span class="err">(</span><span class="na">this</span><span class="err">.</span><span class="na">getServletContext</span><span class="err">().</span><span class="na">getRealPath</span><span class="err">("/")</span> <span class="err">+</span> <span class="err">"</span><span class="na">upload</span><span class="err">"))</span> <span class="err">;//设置服务器保存文件夹</span>
			<span class="na">ServletFileUpload</span> <span class="na">upload =</span><span class="err"> </span><span class="s">new</span> <span class="na">ServletFileUpload</span><span class="err">(</span><span class="na">factory</span><span class="err">)</span> <span class="err">;//创建处理工具</span>
			<span class="na">upload</span><span class="err">.</span><span class="na">setFileSizeMax</span><span class="err">(</span><span class="na">3145728</span><span class="err">)</span> <span class="err">;//设置最大上传大小为</span><span class="na">3M</span><span class="err">，</span><span class="na">3</span><span class="err">*</span><span class="na">1024</span><span class="err">*</span><span class="na">1024</span>
			<span class="na">List</span><span class="err">&lt;</span><span class="na">FileItem</span><span class="nt">&gt;</span> items = upload.parseRequest(request) ;//接收全部内容
			Iterator<span class="nt">&lt;FileItem&gt;</span> itr = items.iterator() ;//将全部内容转换为Iterator实例
			IpTimeStamp its = new IpTimeStamp(request.getRemoteAddr()) ;//实例化Ip时间戳对象
			while(itr.hasNext()){//依次取出每一个内容
				FileItem item = itr.next() ;//取出每一个上传文件
				String fieldName = item.getFieldName() ;//得到表单控件的名称
				if(!item.isFormField()){//不是普通的文本数据，是上传文件
					File saveFile = null ;
					InputStream input = null ;
					OutputStream output = null ;
					input = item.getInputStream() ;
					output = new FileOutputStream(new File(this.getServletContext().getRealPath("/") + "upload" + File.separator + its.getIpTimeRandom() + "." + item.getName().split("\\.")[1])) ;//定义输出文件
					byte[] data = new byte[512] ;
					int temp = 0 ;
					while((temp = input.read(data,0,512)) != -1){//依次读取内容
						output.write(data) ;//保存内容
					}
					input.close() ;
					output.close() ;
				}else{
					String value = item.getString() ;
		%&gt;
				普通参数：<span class="nt">&lt;</span><span class="err">%=</span><span class="na">value</span><span class="err">%</span><span class="nt">&gt;</span>
		<span class="nt">&lt;</span><span class="err">%</span>
				<span class="err">}</span>
			<span class="err">}</span>
		<span class="err">%</span><span class="nt">&gt;</span>
	<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h3 id="2.3">2.3 开发FileUpload组件的专属操作类</h3>

<p>  FileUploadTools.java</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">org</span><span class="p">.</span><span class="n">fmz</span><span class="p">.</span><span class="n">java</span><span class="p">.</span><span class="n">util</span> <span class="p">;</span>

<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.*</span> <span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.*</span> <span class="p">;</span>
<span class="n">import</span> <span class="n">javax</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">http</span><span class="p">.*</span> <span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">fmz</span><span class="p">.</span><span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.*</span> <span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">commons</span><span class="p">.</span><span class="n">fileupload</span><span class="p">.*</span> <span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">commons</span><span class="p">.</span><span class="n">fileupload</span><span class="p">.</span><span class="n">disk</span><span class="p">.*</span> <span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">commons</span><span class="p">.</span><span class="n">fileupload</span><span class="p">.</span><span class="n">servlet</span><span class="p">.*</span> <span class="p">;</span>

<span class="k">public</span> <span class="n">class</span> <span class="n">FileUploadTools</span><span class="p">{</span>
	<span class="n">private</span> <span class="n">HttpServletRequest</span> <span class="n">request</span> <span class="p">=</span> <span class="n">null</span> <span class="p">;//</span><span class="err">取得</span><span class="n">HttpServletRequest</span><span class="err">对象</span>
	<span class="n">private</span> <span class="k">List</span><span class="p">&lt;</span><span class="n">FileItem</span><span class="p">&gt;</span> <span class="n">items</span> <span class="p">=</span> <span class="n">null</span> <span class="p">;//</span><span class="err">保存全部的上传内容</span>
	<span class="n">private</span> <span class="n">Map</span><span class="p">&lt;</span><span class="k">String</span><span class="p">,</span><span class="k">List</span><span class="p">&lt;</span><span class="k">String</span><span class="p">&gt;&gt;</span> <span class="n">params</span> <span class="p">=</span> <span class="n">new</span> <span class="n">HashMap</span><span class="p">&lt;</span><span class="k">String</span><span class="p">,</span><span class="k">List</span><span class="p">&lt;</span><span class="k">String</span><span class="p">&gt;&gt;()</span> <span class="p">;//</span><span class="err">保存所有的参数</span>
	<span class="n">private</span> <span class="n">Map</span><span class="p">&lt;</span><span class="k">String</span><span class="p">,</span><span class="n">FileItem</span><span class="p">&gt;</span> <span class="n">files</span> <span class="p">=</span> <span class="n">new</span> <span class="n">HashMap</span><span class="p">&lt;</span><span class="k">String</span><span class="p">,</span><span class="n">FileItem</span><span class="p">&gt;()</span> <span class="p">;//</span><span class="err">保存全部的上传文件</span>
	<span class="n">private</span> <span class="n">int</span> <span class="n">maxSize</span> <span class="p">=</span> <span class="m">3145728</span> <span class="p">;//</span><span class="err">默认上传文件大小为</span><span class="m">3</span><span class="n">M</span><span class="err">：</span><span class="m">3</span><span class="p">*</span><span class="m">1024</span><span class="p">*</span><span class="m">1024</span>

	<span class="k">public</span> <span class="n">FileUploadTools</span><span class="p">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="p">,</span><span class="n">int</span> <span class="n">maxSize</span><span class="p">,</span><span class="k">String</span> <span class="n">tempDir</span><span class="p">)</span><span class="n">throws</span> <span class="n">Exception</span><span class="p">{//</span><span class="err">传递</span><span class="n">request</span><span class="err">对象，最大上传限制，临时保存目录</span>
		<span class="n">this</span><span class="p">.</span><span class="n">request</span> <span class="p">=</span> <span class="n">request</span> <span class="p">;</span>
		<span class="n">DiskFileItemFactory</span> <span class="n">factory</span> <span class="p">=</span> <span class="n">new</span> <span class="n">DiskFileItemFactory</span><span class="p">()</span> <span class="p">;//</span><span class="err">创建磁盘工厂</span>
		<span class="k">if</span><span class="p">(</span><span class="n">tempDir</span> <span class="c1">!= null){//判断是否需要进行临时文件上传
</span>			<span class="n">factory</span><span class="p">.</span><span class="n">setRepository</span><span class="p">(</span><span class="n">new</span> <span class="n">File</span><span class="p">(</span><span class="n">tempDir</span><span class="p">))</span> <span class="p">;//</span><span class="err">设置临时文件保存目录</span>
		<span class="p">}</span>
		<span class="n">ServletFileUpload</span> <span class="n">upload</span> <span class="p">=</span> <span class="n">new</span> <span class="n">ServletFileUpload</span><span class="p">(</span><span class="n">factory</span><span class="p">)</span> <span class="p">;//</span><span class="err">创建处理工具</span>
		<span class="k">if</span><span class="p">(</span><span class="n">maxSize</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">){//</span><span class="err">如果已知上传大小限制大于</span><span class="m">0</span><span class="err">，则使用新的设置</span>
			<span class="n">this</span><span class="p">.</span><span class="n">maxSize</span> <span class="p">=</span> <span class="n">maxSize</span> <span class="p">;</span>
		<span class="p">}</span>
		<span class="n">upload</span><span class="p">.</span><span class="n">setFileSizeMax</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">maxSize</span><span class="p">)</span> <span class="p">;//</span><span class="err">设置最大上传大小限度为</span><span class="m">3</span><span class="n">M</span><span class="err">：</span><span class="m">3</span><span class="p">*</span><span class="m">1024</span><span class="p">*</span><span class="m">1024</span>
		<span class="n">try</span><span class="p">{</span>
			<span class="n">this</span><span class="p">.</span><span class="n">items</span> <span class="p">=</span> <span class="n">upload</span><span class="p">.</span><span class="n">parseRequest</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="p">;//</span><span class="err">接收全部内容</span>
		<span class="p">}</span><span class="n">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">){</span>
			<span class="n">throw</span> <span class="n">e</span> <span class="p">;//</span><span class="err">向上抛出异常</span>
		<span class="p">}</span>
		<span class="n">this</span><span class="p">.</span><span class="n">init</span><span class="p">()</span> <span class="p">;//</span><span class="err">进行初始化操作</span>
	<span class="p">}</span>

	<span class="k">public</span> <span class="n">void</span> <span class="n">init</span><span class="p">(){</span>
		<span class="n">Iterator</span><span class="p">&lt;</span><span class="n">FileItem</span><span class="p">&gt;</span> <span class="n">iter</span> <span class="p">=</span> <span class="n">this</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">iterator</span><span class="p">()</span> <span class="p">;</span>
		<span class="n">IpTimeStamp</span> <span class="n">its</span> <span class="p">=</span> <span class="n">new</span> <span class="n">IpTimeStamp</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">getRemoteAddr</span><span class="p">())</span> <span class="p">;</span>
		<span class="k">while</span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="n">hasNext</span><span class="p">()){//</span><span class="err">依次取出每一个上传项</span>
			<span class="n">FileItem</span> <span class="n">item</span> <span class="p">=</span> <span class="n">iter</span><span class="p">.</span><span class="k">next</span><span class="p">()</span> <span class="p">;//</span><span class="err">取出每一个上传的文件</span>
			<span class="k">if</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">isFormField</span><span class="p">()){</span>
				<span class="k">String</span> <span class="n">name</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">getFieldName</span><span class="p">()</span> <span class="p">;//</span><span class="err">取得表单的名称</span>
				<span class="k">String</span> <span class="n">value</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">getString</span><span class="p">()</span> <span class="p">;//</span><span class="err">取得表单的内容</span>
				<span class="k">List</span><span class="p">&lt;</span><span class="k">String</span><span class="p">&gt;</span> <span class="n">temp</span> <span class="p">=</span> <span class="n">null</span> <span class="p">;//</span><span class="err">保存内容</span>
				<span class="k">if</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">params</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="n">name</span><span class="p">)){//</span><span class="err">判断内容是否已经存放</span>
					<span class="n">temp</span> <span class="p">=</span> <span class="n">this</span><span class="p">.</span><span class="n">params</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">;//</span><span class="err">如果存在则取出</span>
				<span class="p">}</span><span class="k">else</span><span class="p">{//</span><span class="err">不存在</span>
					<span class="n">temp</span> <span class="p">=</span> <span class="n">new</span> <span class="n">ArrayList</span><span class="p">&lt;</span><span class="k">String</span><span class="p">&gt;()</span> <span class="p">;//</span><span class="err">重新开辟</span><span class="n">list</span><span class="err">数组</span>
				<span class="p">}</span>
				<span class="n">temp</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">;//</span><span class="err">向</span><span class="n">List</span><span class="err">数组中设置内容</span>
				<span class="n">this</span><span class="p">.</span><span class="n">params</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">temp</span><span class="p">)</span> <span class="p">;//</span><span class="err">向</span><span class="n">Map</span><span class="err">中增加内容</span>
			<span class="p">}</span><span class="k">else</span><span class="p">{</span>
				<span class="k">String</span> <span class="n">fileName</span> <span class="p">=</span> <span class="n">its</span><span class="p">.</span><span class="n">getIpTimeRandom</span><span class="p">()</span> <span class="p">+</span> <span class="s2">"."</span> <span class="p">+</span> <span class="n">item</span><span class="p">.</span><span class="n">getName</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">."</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span> <span class="p">;</span>
				<span class="n">this</span><span class="p">.</span><span class="n">files</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span><span class="n">item</span><span class="p">)</span> <span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">public</span> <span class="k">String</span> <span class="n">getParameter</span><span class="p">(</span><span class="k">String</span> <span class="n">name</span><span class="p">){//</span><span class="err">取得一个参数</span>
		<span class="k">String</span> <span class="n">ret</span> <span class="p">=</span> <span class="n">null</span> <span class="p">;//</span><span class="err">保存返回内容</span>
		<span class="k">List</span><span class="p">&lt;</span><span class="k">String</span><span class="p">&gt;</span> <span class="n">temp</span> <span class="p">=</span> <span class="n">this</span><span class="p">.</span><span class="n">params</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">;//</span><span class="err">从集合中取出内容</span>
		<span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="c1">!= null){//判断是否可以根据key值取出内容
</span>			<span class="n">ret</span> <span class="p">=</span> <span class="n">temp</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="m">0</span><span class="p">)</span> <span class="p">;//</span><span class="err">取出其中的内容</span>
		<span class="p">}</span>
		<span class="n">return</span> <span class="n">ret</span> <span class="p">;</span>
	<span class="p">}</span>

	<span class="k">public</span> <span class="k">String</span><span class="p">[]</span> <span class="n">getParameterValues</span><span class="p">(</span><span class="k">String</span> <span class="n">name</span><span class="p">){//</span><span class="err">取得一组上传内容</span>
		<span class="k">String</span><span class="p">[]</span> <span class="n">ret</span> <span class="p">=</span> <span class="n">null</span> <span class="p">;//</span><span class="err">保存返回内容</span>
		<span class="k">List</span><span class="p">&lt;</span><span class="k">String</span><span class="p">&gt;</span> <span class="n">temp</span> <span class="p">=</span> <span class="n">this</span><span class="p">.</span><span class="n">params</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">;//</span><span class="err">从集合中取出内容</span>
		<span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="c1">!= null){//避免NullPointerException
</span>			<span class="n">ret</span> <span class="p">=</span> <span class="n">temp</span><span class="p">.</span><span class="n">toArray</span><span class="p">(</span><span class="n">new</span> <span class="k">String</span><span class="p">[]</span> <span class="p">{})</span> <span class="p">;//</span><span class="err">将内容变为字符串数组</span>
		<span class="p">}</span>
		<span class="n">return</span> <span class="n">ret</span> <span class="p">;</span>
	<span class="p">}</span>

	<span class="k">public</span> <span class="n">Map</span><span class="p">&lt;</span><span class="k">String</span><span class="p">,</span><span class="n">FileItem</span><span class="p">&gt;</span> <span class="n">getUploadFiles</span><span class="p">(){//</span><span class="err">取得全部的上传文件</span>
		<span class="n">return</span> <span class="n">this</span><span class="p">.</span><span class="n">files</span> <span class="p">;//</span><span class="err">得到全部的上传文件</span>
	<span class="p">}</span>

	<span class="k">public</span> <span class="k">List</span><span class="p">&lt;</span><span class="k">String</span><span class="p">&gt;</span> <span class="n">saveAll</span><span class="p">(</span><span class="k">String</span> <span class="n">saveDir</span><span class="p">)</span><span class="n">throws</span> <span class="n">IOException</span><span class="p">{//</span><span class="err">保存全部文件，并返回文件明名称</span>
		<span class="k">List</span><span class="p">&lt;</span><span class="k">String</span><span class="p">&gt;</span> <span class="n">names</span> <span class="p">=</span> <span class="n">new</span> <span class="n">ArrayList</span><span class="p">&lt;</span><span class="k">String</span><span class="p">&gt;()</span> <span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">files</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">){</span>
			<span class="k">Set</span><span class="p">&lt;</span><span class="k">String</span><span class="p">&gt;</span> <span class="n">keys</span> <span class="p">=</span> <span class="n">this</span><span class="p">.</span><span class="n">files</span><span class="p">.</span><span class="n">keySet</span><span class="p">()</span> <span class="p">;//</span><span class="err">取得全部的</span><span class="n">Key</span>
			<span class="n">Iterator</span><span class="p">&lt;</span><span class="k">String</span><span class="p">&gt;</span> <span class="n">iter</span> <span class="p">=</span> <span class="n">keys</span><span class="p">.</span><span class="n">iterator</span><span class="p">()</span> <span class="p">;//</span><span class="err">实例化</span><span class="n">Iterator</span><span class="err">对象</span>
			<span class="n">File</span> <span class="n">saveFile</span> <span class="p">=</span> <span class="n">null</span> <span class="p">;</span>
			<span class="n">InputStream</span> <span class="n">input</span> <span class="p">=</span> <span class="n">null</span> <span class="p">;</span>
			<span class="n">OutputStream</span> <span class="n">output</span> <span class="p">=</span> <span class="n">null</span> <span class="p">;</span>
			<span class="k">while</span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="n">hasNext</span><span class="p">()){</span>
				<span class="n">FileItem</span> <span class="n">item</span> <span class="p">=</span> <span class="n">this</span><span class="p">.</span><span class="n">files</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="k">next</span><span class="p">())</span> <span class="p">;</span>
				<span class="k">String</span> <span class="n">fileName</span> <span class="p">=</span> <span class="n">new</span> <span class="n">IpTimeStamp</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">getRemoteAddr</span><span class="p">()).</span><span class="n">getIpTimeRandom</span><span class="p">()</span> <span class="p">+</span> <span class="s2">"."</span> <span class="p">+</span> <span class="n">item</span><span class="p">.</span><span class="n">getName</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">."</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span> <span class="p">;</span>
				<span class="n">saveFile</span> <span class="p">=</span> <span class="n">new</span> <span class="n">File</span><span class="p">(</span><span class="n">saveDir</span> <span class="p">+</span> <span class="n">fileName</span><span class="p">)</span> <span class="p">;//</span><span class="err">重新拼凑出来的路径</span>
				<span class="n">names</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span> <span class="p">;//</span><span class="err">保存生成后的文件名称</span>
				<span class="n">try</span><span class="p">{</span>
					<span class="n">input</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">getInputStream</span><span class="p">()</span> <span class="p">;</span>
					<span class="n">output</span> <span class="p">=</span> <span class="n">new</span> <span class="n">FileOutputStream</span><span class="p">(</span><span class="n">saveFile</span><span class="p">)</span> <span class="p">;</span>
					<span class="n">int</span> <span class="n">temp</span> <span class="p">=</span> <span class="m">0</span> <span class="p">;</span>
					<span class="n">byte</span><span class="p">[]</span> <span class="n">data</span> <span class="p">=</span> <span class="n">new</span> <span class="n">byte</span><span class="p">[</span><span class="m">512</span><span class="p">]</span> <span class="p">;</span>
					<span class="k">while</span><span class="p">((</span><span class="n">temp</span> <span class="p">=</span> <span class="n">input</span><span class="p">.</span><span class="nb">read</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">512</span><span class="p">))</span> <span class="c1">!= -1){
</span>						<span class="n">output</span><span class="p">.</span><span class="nb">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span><span class="n">catch</span><span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">){</span>
					<span class="n">throw</span> <span class="n">e</span> <span class="p">;</span>
				<span class="p">}</span><span class="n">finally</span><span class="p">{</span>
					<span class="n">try</span><span class="p">{</span>
						<span class="n">input</span><span class="p">.</span><span class="n">close</span><span class="p">()</span> <span class="p">;</span>
						<span class="n">output</span><span class="p">.</span><span class="n">close</span><span class="p">()</span> <span class="p">;</span>
					<span class="p">}</span><span class="n">catch</span><span class="p">(</span><span class="n">IOException</span> <span class="n">e1</span><span class="p">){</span>
						<span class="n">throw</span> <span class="n">e1</span> <span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="n">return</span> <span class="n">names</span> <span class="p">;</span>
	<span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<p>  混合表单-file_upload_demo03.html</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
	<span class="nt">&lt;head&gt;</span>
		<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;title&gt;&lt;/title&gt;</span>
	<span class="nt">&lt;/head&gt;</span>
	<span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"file_upload_demo03.jsp"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
			姓名：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"uname"</span><span class="nt">&gt;&lt;br&gt;</span>
			兴趣：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"inst"</span> <span class="na">value=</span><span class="s">"Swim"</span><span class="nt">&gt;</span>游泳
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"inst"</span> <span class="na">value=</span><span class="s">"Sing"</span><span class="nt">&gt;</span>唱歌
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"inst"</span> <span class="na">value=</span><span class="s">"Run"</span><span class="nt">&gt;</span>跑步
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"inst"</span> <span class="na">value=</span><span class="s">"Read"</span><span class="nt">&gt;</span>读书<span class="nt">&lt;br&gt;</span>
			照片1：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"pic01"</span><span class="nt">&gt;&lt;br&gt;</span>
			照片2：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"pic02"</span><span class="nt">&gt;&lt;br&gt;</span>
			照片3：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"pic03"</span><span class="nt">&gt;&lt;br&gt;</span>
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"提交"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"reset"</span> <span class="na">value=</span><span class="s">"重置"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;/form&gt;</span>
	<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>  接收表单-file_upload_demo03.jsp</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">contentType=</span><span class="s">"text/html"</span> <span class="na">pageEncoding=</span><span class="s">"utf-8"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">import=</span><span class="s">"java.util.*"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">import=</span><span class="s">"org.fmz.java.util.*"</span><span class="err">%</span><span class="nt">&gt;</span>

<span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
	<span class="nt">&lt;head&gt;</span>
		<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;title&gt;&lt;/title&gt;</span>
	<span class="nt">&lt;/head&gt;</span>
	<span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;</span><span class="err">%</span>
			<span class="na">request</span><span class="err">.</span><span class="na">setCharacterEncoding</span><span class="err">("</span><span class="na">utf-8</span><span class="err">")</span> <span class="err">;</span>
			<span class="na">FileUploadTools</span> <span class="na">fut =</span><span class="err"> </span><span class="s">new</span> <span class="na">FileUploadTools</span><span class="err">(</span><span class="na">request</span><span class="err">,</span><span class="na">3</span><span class="err">*</span><span class="na">1024</span><span class="err">*</span><span class="na">1024</span><span class="err">,</span><span class="na">this</span><span class="err">.</span><span class="na">getServletContext</span><span class="err">().</span><span class="na">getRealPath</span><span class="err">("/")</span> <span class="err">+</span> <span class="err">"</span><span class="na">uploadtemp</span><span class="err">")</span> <span class="err">;</span>
			<span class="na">String</span> <span class="na">name =</span><span class="err"> </span><span class="s">fut.getParameter("uname")</span> <span class="err">;</span>
			<span class="na">String</span><span class="err">[]</span> <span class="na">inst =</span><span class="err"> </span><span class="s">fut.getParameterValues("inst")</span> <span class="err">;</span>
			<span class="na">List</span><span class="err">&lt;</span><span class="na">String</span><span class="nt">&gt;</span> list = fut.saveAll(this.getServletContext().getRealPath("/") + "upload" + java.io.File.separator) ;
		%&gt;
			<span class="nt">&lt;h3&gt;</span>姓名：<span class="nt">&lt;</span><span class="err">%=</span><span class="na">name</span><span class="err">%</span><span class="nt">&gt;&lt;/h3&gt;</span>
			<span class="nt">&lt;h3&gt;</span>兴趣：
		<span class="nt">&lt;</span><span class="err">%</span>
			<span class="na">for</span><span class="err">(</span><span class="na">int</span> <span class="na">x=</span><span class="s">0;x&lt;inst.length;x++){</span>
		<span class="err">%</span><span class="nt">&gt;</span>
				<span class="nt">&lt;</span><span class="err">%=</span><span class="na">inst</span><span class="err">[</span><span class="na">x</span><span class="err">]%</span><span class="nt">&gt;</span>、
		<span class="nt">&lt;</span><span class="err">%</span>
			<span class="err">}</span>
		<span class="err">%</span><span class="nt">&gt;</span>
			<span class="nt">&lt;/h3&gt;</span>
		<span class="nt">&lt;</span><span class="err">%</span>
			<span class="na">Iterator</span><span class="err">&lt;</span><span class="na">String</span><span class="nt">&gt;</span> iter = list.iterator() ;
			while(iter.hasNext()){
		%&gt;
				<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"../upload/&lt;%=iter.next()%&gt;"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;</span><span class="err">%</span>
			<span class="err">}</span>
		<span class="err">%</span><span class="nt">&gt;</span>
	<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>FileUploadTools只是完成了一些基本的功能，可以在此基础上进一步的完善，以适应各种开发的需求。</p>
</blockquote>

<hr />

<hr />

</div>

      <div class="footer">
        <div class="disclaimer">
  
  <p>
    The postings on this site are my own and I am only responsible for myself
  </p>
  

  <p>
    © 麦羞, 2017 &mdash; built with Jekyll based on Github
  </p>
</div>

      </div>
    </div>
  </div>


<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34087103-1']);
  
  _gaq.push(['_setDomainName', 'lenage.com']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


<script type="text/javascript" src="/blogs/assets/scripts/MathJax-2.0-min.js"></script>
<script type="text/javascript" src="/blogs/assets/scripts/jquery-1.11.3.min.js"></script>
<script>
  $(function(){
    var $category = $('ul#java-posts li:gt(8):not(:last)');
    $category.hide();
    var $toggleBtn=$('div.java-showmore > a') ;
    $toggleBtn.click(function(){
      if($category.is(":visible")){
            $category.hide() ;
            $('div.java-showmore a span')
              .text("More...") ;
          }else{
            $category.show() ;
            $('div.java-showmore a span')
            .text("Less") ;
          }
          return false ;
    })
  })

  $(function(){
    var $category = $('ul#diary-posts li:gt(8):not(:last)');
    $category.hide();
    var $toggleBtn=$('div.diary-showmore > a') ;
    $toggleBtn.click(function(){
      if($category.is(":visible")){
            $category.hide() ;
            $('div.diary-showmore a span')
              .text("More...") ;
          }else{
            $category.show() ;
            $('div.diary-showmore a span')
            .text("Less") ;
          }
          return false ;
    })
  })
</script>

</body>
</html>
